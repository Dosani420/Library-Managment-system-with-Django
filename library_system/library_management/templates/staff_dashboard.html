{% extends 'staff_base.html' %}

{% block title %}Dashboard - Staff Portal{% endblock title %}

{% block body %}
<div class="main-content">
    <!-- Enhanced Header -->
    <header class="dashboard-header" style="margin-bottom: 2.5rem;">
        <div>
            <h1
                style="font-size: 2.25rem; margin-bottom: 0.5rem; font-weight: 800; display: flex; align-items: center; gap: 0.75rem;">
                <i data-lucide="layout-dashboard" style="width: 36px; height: 36px; color: var(--primary);"></i>
                Dashboard Overview
            </h1>
            <p style="color: var(--text-secondary); font-size: 1.1rem;">Welcome back, {{ user.first_name }}! Here's
                what's happening in the library.</p>
        </div>
        <div style="text-align: right;">
            <div style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 0.25rem;">Today's Date</div>
            <div style="font-size: 1.1rem; font-weight: 700; color: var(--text-main);">{% now "l, F j, Y" %}</div>
        </div>
    </header>

    <!-- Messages -->
    {% if messages %}
    <div style="margin-bottom: 2rem;">
        {% for message in messages %}
        <div data-django-message
            data-message-type="{% if message.tags == 'success' %}success{% elif message.tags == 'error' %}error{% else %}info{% endif %}"
            style="display: none;">
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Enhanced Stats Grid with Trends -->
    <div class="stats-grid"
        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem; margin-bottom: 3rem;">
        <!-- Total Books Card -->
        <div class="stat-card hover-lift"
            style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 2rem;">
            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1.5rem;">
                <div
                    style="width: 56px; height: 56px; background: rgba(255, 255, 255, 0.2); backdrop-filter: blur(10px); border-radius: 16px; display: flex; align-items: center; justify-content: center;">
                    <i data-lucide="library" style="width: 28px; height: 28px;"></i>
                </div>
                <span
                    style="font-size: 0.85rem; background: rgba(16, 185, 129, 0.2); color: white; padding: 0.4rem 0.8rem; border-radius: 999px; font-weight: 700; display: flex; align-items: center; gap: 0.25rem;">
                    <i data-lucide="trending-up" style="width: 14px; height: 14px;"></i>
                    +12%
                </span>
            </div>
            <div style="font-size: 3rem; font-weight: 900; margin-bottom: 0.5rem; line-height: 1;">{{ total_books }}
            </div>
            <div style="opacity: 0.95; font-size: 1.05rem; font-weight: 600; margin-bottom: 1rem;">Total Books in
                Collection</div>
            <div class="progress-bar" style="background: rgba(255, 255, 255, 0.2);">
                <div class="progress-fill" style="width: 75%; background: white;"></div>
            </div>
        </div>

        <!-- Total Members Card -->
        <div class="stat-card hover-lift" style="padding: 2rem;">
            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1.5rem;">
                <div
                    style="width: 56px; height: 56px; background: rgba(139, 92, 246, 0.1); color: #8b5cf6; border-radius: 16px; display: flex; align-items: center; justify-content: center;">
                    <i data-lucide="users" style="width: 28px; height: 28px;"></i>
                </div>
                <span
                    style="font-size: 0.85rem; background: rgba(16, 185, 129, 0.1); color: var(--success); padding: 0.4rem 0.8rem; border-radius: 999px; font-weight: 700; display: flex; align-items: center; gap: 0.25rem;">
                    <i data-lucide="trending-up" style="width: 14px; height: 14px;"></i>
                    +8%
                </span>
            </div>
            <div style="font-size: 3rem; font-weight: 900; color: #8b5cf6; margin-bottom: 0.5rem; line-height: 1;">{{ total_members }}</div>
            <div style="color: var(--text-secondary); font-size: 1.05rem; font-weight: 600; margin-bottom: 1rem;">
                Registered Members</div>
            <div style="display: flex; gap: 1rem; font-size: 0.85rem;">
                <div
                    style="flex: 1; padding: 0.75rem; background: rgba(139, 92, 246, 0.05); border-radius: var(--radius-sm); text-align: center;">
                    <div style="font-weight: 800; color: #8b5cf6; font-size: 1.25rem;">{{ total_members|add:"-5" }}
                    </div>
                    <div style="color: var(--text-muted); font-size: 0.75rem;">Active</div>
                </div>
                <div
                    style="flex: 1; padding: 0.75rem; background: rgba(245, 158, 11, 0.05); border-radius: var(--radius-sm); text-align: center;">
                    <div style="font-weight: 800; color: var(--warning); font-size: 1.25rem;">5</div>
                    <div style="color: var(--text-muted); font-size: 0.75rem;">New</div>
                </div>
            </div>
        </div>

        <!-- Active Loans Card -->
        <div class="stat-card hover-lift" style="padding: 2rem;">
            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1.5rem;">
                <div
                    style="width: 56px; height: 56px; background: rgba(16, 185, 129, 0.1); color: var(--success); border-radius: 16px; display: flex; align-items: center; justify-content: center;">
                    <i data-lucide="book-open" style="width: 28px; height: 28px;"></i>
                </div>
                <span
                    style="font-size: 0.85rem; background: rgba(245, 158, 11, 0.1); color: var(--warning); padding: 0.4rem 0.8rem; border-radius: 999px; font-weight: 700;">
                    Active
                </span>
            </div>
            <div
                style="font-size: 3rem; font-weight: 900; color: var(--success); margin-bottom: 0.5rem; line-height: 1;">
                {{ active_loans }}</div>
            <div style="color: var(--text-secondary); font-size: 1.05rem; font-weight: 600; margin-bottom: 1rem;">Books
                Currently Borrowed</div>
            <div
                style="display: flex; justify-content: space-between; align-items: center; padding-top: 1rem; border-top: 1px solid var(--border-light);">
                <span style="font-size: 0.85rem; color: var(--text-muted);">Utilization Rate</span>
                <span style="font-weight: 800; color: var(--success);">{% widthratio active_loans total_books 100 %}</span>
            </div>
        </div>

        <!-- Overdue Books Card -->
        <div class="stat-card hover-lift" style="padding: 2rem;">
            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1.5rem;">
                <div
                    style="width: 56px; height: 56px; background: rgba(239, 68, 68, 0.1); color: var(--danger); border-radius: 16px; display: flex; align-items: center; justify-content: center;">
                    <i data-lucide="alert-triangle" style="width: 28px; height: 28px;"></i>
                </div>
                {% if overdue_books > 0 %}
                <span
                    style="font-size: 0.85rem; background: rgba(239, 68, 68, 0.1); color: var(--danger); padding: 0.4rem 0.8rem; border-radius: 999px; font-weight: 700; animation: pulse 2s infinite;">
                    Action Needed
                </span>
                {% else %}
                <span
                    style="font-size: 0.85rem; background: rgba(16, 185, 129, 0.1); color: var(--success); padding: 0.4rem 0.8rem; border-radius: 999px; font-weight: 700;">
                    <i data-lucide="check" style="width: 14px; height: 14px;"></i>
                    All Clear
                </span>
                {% endif %}
            </div>
            <div
                style="font-size: 3rem; font-weight: 900; color: var(--danger); margin-bottom: 0.5rem; line-height: 1;">
                {{ overdue_books }}</div>
            <div style="color: var(--text-secondary); font-size: 1.05rem; font-weight: 600; margin-bottom: 1rem;">
                Overdue Returns</div>
            {% if overdue_books > 0 %}
            <button class="btn btn-danger" style="width: 100%; font-weight: 700;">
                <i data-lucide="bell" style="width: 16px; height: 16px;"></i>
                Send Reminders
            </button>
            {% else %}
            <div
                style="text-align: center; padding: 0.75rem; background: rgba(16, 185, 129, 0.05); border-radius: var(--radius-sm); color: var(--success); font-weight: 600;">
                No overdue books
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Charts and Analytics Section -->
    <div class="charts-section" style="display: grid; grid-template-columns: 2fr 1fr; gap: 2rem; margin-bottom: 3rem;">
        <!-- Borrowing Trends Chart -->
        <div class="glass-card" style="padding: 2rem;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                <div>
                    <h2 style="font-size: 1.5rem; font-weight: 800; margin-bottom: 0.5rem;">Borrowing Trends</h2>
                    <p style="color: var(--text-muted); font-size: 0.95rem;">Weekly activity overview</p>
                </div>
                <div style="display: flex; gap: 0.5rem;">
                    <button class="btn btn-sm"
                        style="background: rgba(99, 102, 241, 0.1); color: var(--primary); font-weight: 700;">Week</button>
                    <button class="btn btn-sm btn-secondary">Month</button>
                    <button class="btn btn-sm btn-secondary">Year</button>
                </div>
            </div>

            <!-- Enhanced Bar Chart -->
            <div
                style="display: flex; align-items: flex-end; justify-content: space-between; height: 280px; gap: 1rem; padding: 1rem; background: var(--bg-body); border-radius: var(--radius-lg);">
                {% for day in "1234567" %}
                <div style="flex: 1; display: flex; flex-direction: column; align-items: center; gap: 0.75rem;">
                    <div style="position: relative; width: 100%; background: linear-gradient(to top, var(--primary), var(--secondary)); border-radius: 12px 12px 0 0; height: {% cycle '65' '85' '50' '95' '75' '60' '90' %}%; transition: all 0.3s; cursor: pointer; box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);"
                        onmouseover="this.style.transform='translateY(-8px)'; this.style.boxShadow='0 8px 24px rgba(99, 102, 241, 0.4)'"
                        onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(99, 102, 241, 0.3)'">
                        <div style="position: absolute; top: -2rem; left: 50%; transform: translateX(-50%); background: var(--text-main); color: white; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem; font-weight: 700; opacity: 0; transition: opacity 0.3s;"
                            onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0'">
                            {% cycle '45' '68' '32' '78' '56' '41' '72' %} books
                        </div>
                    </div>
                    <div style="display: flex; flex-direction: column; align-items: center; gap: 0.25rem;">
                        <span style="font-size: 0.8rem; color: var(--text-main); font-weight: 700;">{% cycle 'Mon' 'Tue' 'Wed' 'Thu' 'Fri' 'Sat' 'Sun' %}</span>
                        <span style="font-size: 0.7rem; color: var(--text-muted);">{% cycle 'Jan 20' 'Jan 21' 'Jan 22' 'Jan 23' 'Jan 24' 'Jan 25' 'Jan 26' %}</span>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Top Genres Card -->
        <div class="glass-card" style="padding: 2rem;">
            <h3 style="font-size: 1.25rem; font-weight: 800; margin-bottom: 1.5rem;">Popular Genres</h3>
            <div style="display: flex; flex-direction: column; gap: 1.25rem;">
                <div>
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                        <span style="font-weight: 700; color: var(--text-main);">Fiction</span>
                        <span style="font-weight: 800; color: #667eea;">85%</span>
                    </div>
                    <div class="progress-bar" style="height: 10px;">
                        <div class="progress-fill" style="width: 85%; background: #667eea;"></div>
                    </div>
                </div>
                <div>
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                        <span style="font-weight: 700; color: var(--text-main);">Mystery</span>
                        <span style="font-weight: 800; color: #764ba2;">72%</span>
                    </div>
                    <div class="progress-bar" style="height: 10px;">
                        <div class="progress-fill" style="width: 72%; background: #764ba2;"></div>
                    </div>
                </div>
                <div>
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                        <span style="font-weight: 700; color: var(--text-main);">Science</span>
                        <span style="font-weight: 800; color: #f093fb;">68%</span>
                    </div>
                    <div class="progress-bar" style="height: 10px;">
                        <div class="progress-fill" style="width: 68%; background: #f093fb;"></div>
                    </div>
                </div>
                <div>
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                        <span style="font-weight: 700; color: var(--text-main);">Romance</span>
                        <span style="font-weight: 800; color: #f5576c;">55%</span>
                    </div>
                    <div class="progress-bar" style="height: 10px;">
                        <div class="progress-fill" style="width: 55%; background: #f5576c;"></div>
                    </div>
                </div>
                <div>
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                        <span style="font-weight: 700; color: var(--text-main);">History</span>
                        <span style="font-weight: 800; color: #4facfe;">48%</span>
                    </div>
                    <div class="progress-bar" style="height: 10px;">
                        <div class="progress-fill" style="width: 48%; background: #4facfe;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions and Recent Activity -->
    <div class="quick-actions-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
        <!-- Quick Actions -->
        <div class="glass-card" style="padding: 2rem;">
            <h3
                style="font-size: 1.25rem; font-weight: 800; margin-bottom: 1.5rem; display: flex; align-items: center; gap: 0.5rem;">
                <i data-lucide="zap" style="width: 20px; height: 20px; color: var(--warning);"></i>
                Quick Actions
            </h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 1rem;">
                <a href="{% url 'add_book' %}" class="btn btn-primary"
                    style="padding: 1.25rem; flex-direction: column; gap: 0.75rem; height: auto;">
                    <i data-lucide="plus-circle" style="width: 32px; height: 32px;"></i>
                    <span style="font-weight: 700;">Add Book</span>
                </a>
                <a href="{% url 'manage_books' %}" class="btn btn-secondary"
                    style="padding: 1.25rem; flex-direction: column; gap: 0.75rem; height: auto;">
                    <i data-lucide="library" style="width: 32px; height: 32px;"></i>
                    <span style="font-weight: 700;">Manage Books</span>
                </a>
                <button class="btn btn-secondary"
                    style="padding: 1.25rem; flex-direction: column; gap: 0.75rem; height: auto;">
                    <i data-lucide="users" style="width: 32px; height: 32px;"></i>
                    <span style="font-weight: 700;">View Members</span>
                </button>
                <button class="btn btn-secondary"
                    style="padding: 1.25rem; flex-direction: column; gap: 0.75rem; height: auto;">
                    <i data-lucide="file-text" style="width: 32px; height: 32px;"></i>
                    <span style="font-weight: 700;">Reports</span>
                </button>
            </div>
        </div>

        <!-- Recent Activity -->
        <div class="glass-card" style="padding: 2rem;">
            <h3
                style="font-size: 1.25rem; font-weight: 800; margin-bottom: 1.5rem; display: flex; align-items: center; gap: 0.5rem;">
                <i data-lucide="activity" style="width: 20px; height: 20px; color: var(--success);"></i>
                Recent Activity
            </h3>
            <div style="display: flex; flex-direction: column; gap: 1rem;">
                {% for i in "123456" %}
                <div
                    style="display: flex; gap: 1rem; padding: 1rem; background: white; border-radius: var(--radius-md); border-left: 3px solid {% cycle 'var(--success)' 'var(--primary)' 'var(--warning)' 'var(--success)' 'var(--danger)' 'var(--primary)' %};">
                    <div
                        style="width: 40px; height: 40px; background: {% cycle 'rgba(16, 185, 129, 0.1)' 'rgba(99, 102, 241, 0.1)' 'rgba(245, 158, 11, 0.1)' 'rgba(16, 185, 129, 0.1)' 'rgba(239, 68, 68, 0.1)' 'rgba(99, 102, 241, 0.1)' %}; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                        <i data-lucide="{% cycle 'check' 'book-plus' 'clock' 'user-plus' 'alert-circle' 'book' %}"
                            style="width: 20px; height: 20px; color: {% cycle 'var(--success)' 'var(--primary)' 'var(--warning)' 'var(--success)' 'var(--danger)' 'var(--primary)' %};"></i>
                    </div>
                    <div style="flex: 1;">
                        <div style="font-weight: 700; font-size: 0.9rem; margin-bottom: 0.25rem;">{% cycle 'Book Returned' 'New Book Added' 'Due Soon' 'New Member' 'Overdue Book' 'Book Borrowed' %}</div>
                        <div style="font-size: 0.8rem; color: var(--text-muted);">{% cycle 'John Doe returned "The Great Gatsby"' 'Staff added "1984" to collection' 'Member has 2 books due tomorrow' 'Jane Smith joined the library' 'Book overdue by 3 days' 'Alice borrowed "To Kill a Mockingbird"' %}
                        </div>
                        <div style="font-size: 0.75rem; color: var(--text-muted); margin-top: 0.25rem;">{% cycle '2 mins ago' '15 mins ago' '1 hour ago' '2 hours ago' '3 hours ago' '5 hours ago' %}</div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% endblock body %}