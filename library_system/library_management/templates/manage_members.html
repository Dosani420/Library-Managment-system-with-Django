{% extends "staff_base.html" %}

{% block title %}
Manage Memebers
{% endblock title %}

{% block body %}

<!-- Enhanced Header with Search and Filters -->
<header class="dashboard-header" style="flex-wrap: wrap; gap: 1.5rem; margin-bottom: 2rem;">
    <div style="flex: 1; min-width: 300px;">
        <h1
            style="font-size: 2rem; margin-bottom: 0.5rem; font-weight: 800; display: flex; align-items: center; gap: 0.5rem;">
            <i data-lucide="users" style="width: 32px; height: 32px; color: var(--primary);"></i>
            Registered Members
        </h1>
        <p style="color: var(--text-secondary); font-size: 1.05rem;">{{ members|length }} Members are Registered</p>
    </div>

    <!-- Advanced Search Bar -->
    <div class="search-wrapper" style="flex: 1; min-width: 350px; max-width: 500px; position: relative;">
        <i data-lucide="search" class="search-icon" style="width: 20px; height: 20px;"></i>
        <input type="text" id="searchInput" placeholder="Search by member name..."
            style="padding: 1rem 1rem 1rem 3rem; border: 2px solid var(--border-light); border-radius: var(--radius-lg); width: 100%; font-size: 1rem; transition: all 0.3s; background: var(--bg-surface); color: var(--text-main);">
    </div>
</header>

{% if messages %}
<div style="margin-bottom: 2rem;">
    {% for message in messages %}
    <div data-django-message
        data-message-type="{% if message.tags == 'success' %}success{% elif message.tags == 'error' %}error{% else %}info{% endif %}"
        style="display: none;">
        {{ message }}
    </div>
    {% endfor %}
</div>
{% endif %}

<!-- Filters and View Toggle Bar -->
<div
    style="background: var(--bg-surface); padding: 1.5rem; border-radius: var(--radius-lg); box-shadow: 0 2px 8px rgba(0,0,0,0.05); margin-bottom: 2rem;">
    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
        <!-- Filters -->
        <div style="display: flex; gap: 1rem; flex-wrap: wrap; flex: 1;">
            <select id="statusFilter" class="form-control" style="width: auto; min-width: 150px;">
                <option value="">All Memebers</option>
                <option value="active">Active</option>
                <option value="inactive">Inactive</option>
                <option value="blocked">Blocked</option>
            </select>

            <select id="sortFilter" class="form-control" style="width: auto; min-width: 150px;">
                <option value="newest">Newest First</option>
                <option value="oldest">Oldest First</option>
                <option value="title-asc">Title (A-Z)</option>
                <option value="title-desc">Title (Z-A)</option>
                <option value="author-asc">Author (A-Z)</option>
                <option value="price-low">Price (Low to High)</option>
                <option value="price-high">Price (High to Low)</option>
            </select>

            <button class="btn btn-secondary" data-reset-filters>
                <i data-lucide="rotate-ccw" style="width: 16px; height: 16px;"></i>
                Reset
            </button>
        </div>

        <!-- View Toggle -->
        <div
            style="display: flex; gap: 0.5rem; background: var(--bg-body); padding: 0.25rem; border-radius: var(--radius-md);">
            <button id="gridViewBtn" class="btn btn-sm"
                style="background: var(--bg-surface); box-shadow: 0 2px 4px var(--shadow-sm);">
                <i data-lucide="grid-3x3" style="width: 18px; height: 18px;"></i>
            </button>
            <button id="listViewBtn" class="btn btn-sm btn-secondary">
                <i data-lucide="list" style="width: 18px; height: 18px;"></i>
            </button>
        </div>
    </div>
</div>

<!-- Stats Bar -->
<div
    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
    <div class="stat-card hover-lift" style="padding: 1.25rem;">
        <div style="display: flex; align-items: center; gap: 1rem;">
            <div class="stat-icon"
                style="background: rgba(16, 185, 129, 0.1); color: var(--success); width: 48px; height: 48px;">
                <i data-lucide="user-check" style="width: 24px; height: 24px;"></i>
            </div>
            <div>
                <div style="font-size: 1.75rem; font-weight: 800;">{{ active }}</div>
                <div style="color: var(--text-muted); font-size: 0.85rem;">Active Members</div>
            </div>
        </div>
    </div>

    <div class="stat-card hover-lift" style="padding: 1.25rem;">
        <div style="display: flex; align-items: center; gap: 1rem;">
            <div class="stat-icon"
                style="background: rgba(99, 102, 241, 0.1); color: var(--primary); width: 48px; height: 48px;">
                <i data-lucide="moon" style="width: 24px; height: 24px;"></i>
            </div>
            <div>
                <div style="font-size: 1.75rem; font-weight: 800;">{{ inactive }}</div>
                <div style="color: var(--text-muted); font-size: 0.85rem;">Inactive Member</div>
            </div>
        </div>
    </div>

    <div class="stat-card hover-lift" style="padding: 1.25rem;">
        <div style="display: flex; align-items: center; gap: 1rem;">
            <div class="stat-icon"
                style="background: rgba(245, 158, 11, 0.1); color: var(--warning); width: 48px; height: 48px;">
                <i data-lucide="user-round-x" style="width: 24px; height: 24px;"></i>
            </div>
            <div>
                <div style="font-size: 1.75rem; font-weight: 800;">{{ blocked }}</div>
                <div style="color: var(--text-muted); font-size: 0.85rem;">Blocked</div>
            </div>
        </div>
    </div>
</div>

<!-- Member Grid View -->
<div id="gridView" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 2rem;">
    {% for member in members %}
    <div class="member-card hover-lift" data-first="{{ member.user.first_name|lower }}"
        data-last="{{ member.user.last_name|lower }}" data-status="{{ member.status|lower }}"
        data-id="{{ member.member_id }}"
        style="background: var(--bg-surface); border-radius: var(--radius-xl); overflow: hidden; box-shadow: 0 4px 16px rgba(0,0,0,0.08); transition: all 0.3s; cursor: pointer;">

        <!-- Member DP with Overlay -->
        <div
            style="position: relative; overflow: hidden; height: 250px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
            {% if member.Image %}
            <img src="{{ member.Image.url }}" alt="{{ member.user.first_name }}"
                style="width: 100%; height: 100%; object-fit: cover; transition: transform 0.5s;"
                class="book-cover-hover">
            {% else %}
            <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center;">
                <i data-lucide="user" style="width: 100px; height: 100px; color: white; opacity: 0.4;"></i>
            </div>
            {% endif %}

            <!-- Status Badge -->
            <div
                style="position: absolute; top: 1rem; right: 1rem; font-size: 0.85rem; font-weight: 700; display: flex; ">
                <span class="status-{{ member.status|lower }}">{{ member.status }}</span>
            </div>

            <!-- Quick View Overlay -->
            <div style="position: absolute; inset: 0; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; opacity: 0; transition: opacity 0.3s;"
                onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0'">
                <button onclick="window.location.href='{% url 'edit_member' member.id %}'" class="btn btn-primary"
                    style="transform: scale(1.1);">
                    <i data-lucide="pen" style="width: 20px; height: 20px;"></i>
                    Edit
                </button>
            </div>
        </div>

        <!-- Member Details -->
        <div style="padding: 1.5rem;">
            <h3
                style="font-size: 1.25rem; font-weight: 800; margin-bottom: 0.5rem; line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; color: var(--text-main);">
                {{ member.user.first_name }}
            </h3>
            <p style="color: var(--text-secondary); font-size: 1.25rem; margin-bottom: 1rem; font-weight: 500;">
                {{ member.user.last_name }}</p>

            <!-- Member Meta -->
            <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; margin-bottom: 1.25rem;">
                <span class="role-badge"
                    style="background: rgba(99, 102, 241, 0.1); color: var(--primary); font-size: 0.8rem; display: flex; align-items: center; gap: 0.25rem;">
                    {% if member.gender == Male %}
                    <i data-lucide="mars" style="width: 12px; height: 12px;"></i>
                    {% else %}
                    <i data-lucide="venus" style="width: 20px; height: 20px;"></i>
                    {% endif %}
                    {{ member.gender }}
                </span>
                <span class="role-badge"
                    style="background: rgba(245, 158, 11, 0.1); color: var(--warning); font-size: 1.25rem; display: flex; align-items: center; gap: 0.25rem;">
                    <i data-lucide="book-open" style="width: 20px; height: 20px;"></i>
                    {{ member.borrow_count }}
                </span>
            </div>

            <!-- Price and Action -->
            <div
                style="display: flex; justify-content: space-between; align-items: center; padding-top: 1.25rem; border-top: 2px solid var(--border-light);">
                <div>
                    <div
                        style="font-size: 1.25rem; color: var(--primary); font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em;">
                        ID</div>
                    <div style="font-weight: 800; color: var(--text-muted); font-size: 0.75rem;"> MBR-{{ member.lib_id }}
                    </div>
                </div>
                <button onclick="window.location.href='#'" class="btn btn-primary"
                    style="padding: 0.75rem 1.25rem; font-weight: 700;">
                    <i data-lucide="user-round-x" style="width: 18px; height: 18px;"></i>
                    Block
                </button>
            </div>
        </div>
    </div>
    {% empty %}
    <div class="empty-state" style="grid-column: 1 / -1; padding: 5rem 2rem;">
        <div class="empty-state-icon">
            <i data-lucide="book-x" style="width: 80px; height: 80px;"></i>
        </div>
        <h3 class="empty-state-title" style="font-size: 2rem;">No Books Found</h3>
        <p class="empty-state-description" style="font-size: 1.1rem;">Try adjusting your filters or search terms</p>
        <button class="btn btn-primary" style="margin-top: 1.5rem;" data-reset-filters>
            <i data-lucide="rotate-ccw" style="width: 18px; height: 18px;"></i>
            Reset Filters
        </button>
    </div>
    {% endfor %}
</div>

{% endblock body %}